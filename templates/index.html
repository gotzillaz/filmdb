<!DOCTYPE html>
<html lang='en'>
  <head>

    <!--
      ===================================
                  Stylesheet
      ===================================
    -->

    <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Ubuntu+Mono'>
    <style>

      body { position: relative; display: block; padding: 1px; margin: 0; color: #272822; background-color: #f9f9f9; font-family:  'Ubuntu Mono'; font-size: 14px; }
      h1 { margin: 48px; text-align: center; }

      .wrapper { position: relative; display: block; width: 480px; max-width: 80%; padding: 16px; margin: auto; border-radius: 4px; box-shadow: 0 0 8px #272822; background-color: #272822; overflow: hidden; }
      .editor { position: relative; display: block; width: 480px; height: 180px; margin: auto; }
      .editor-submit { float: right; position: relative; display: inline-block; padding: 8px 12px; margin-top: 16px; border-radius: 4px; border: none; outline: none; cursor: pointer; font-family: inherit; font-size: 0.8rem; opacity: 0.2; text-transform: uppercase; transition: opacity 0.4s ease-in-out; }
      .editor-submit:hover { opacity: 0.8; }

    </style>
    <title>Movies & Series Database</title>
  </head>
  <body>

    <!--
      ===================================
                     HTML
      ===================================
    -->

    <h1>Movies & Series Database</h1>
    <form id='form' class='wrapper' method='post' action='/select'>
      <div id='editor' class='editor'># Input your SQL query here</div>
      <button type='submit' class='editor-submit'>Submit</button>
    </form>

    <!--
      ===================================
                  JavaScript
      ===================================
    -->

    <script src='https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.9/ace.js'></script>
    <script>

      function ajaxPost(url, params, callback) {
        var req  = new XMLHttpRequest();
        req.onreadystatechange = function () {
          if (req.readyState === 4 && req.status === 200) {
            callback(req.responseText);
          }
        }
        req.open('POST', url, true);
        req.send(params);
      }

      function queryResponseHandler(data) {
        var records = JSON.parse(data);
        if (records instanceof Array) {
          console.log(records);
        } else {
          alert('Something wrong!!');
        }
      }

      document.addEventListener('DOMContentLoaded', function () {

        var editor = ace.edit('editor');
        editor.setTheme('ace/theme/monokai');
        editor.getSession().setMode('ace/mode/mysql');
        editor.renderer.setShowGutter(false);
        editor.focus();

        var form = document.getElementById('form');
        form.addEventListener('submit', function (event) {
          var url    = form.action,
              params = JSON.stringify({ query: editor.getSession().getValue().trim() });
          if (event.which !== 13) {
            ajaxPost(url, params, queryResponseHandler);
          }
          event.preventDefault();
        });
      });

    </script>
  </body>
</html>
